package bmw.poc.rfc;

import java.util.List;
import java.util.Map;
import io.smallrye.mutiny.Multi;
import io.smallrye.mutiny.Uni;
import jakarta.enterprise.context.ApplicationScoped;
import jakarta.ws.rs.GET;
import jakarta.ws.rs.Path;
import jakarta.ws.rs.PathParam;
import lombok.extern.slf4j.Slf4j;


@Slf4j
@Path("/get")
@ApplicationScoped
public class Get2 {

    private static final Map<String, List<String>> map =
        Map.of(
            "001", List.of("Lorem ipsum dolor sit amet, consectetur adipiscing elit.", "Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.", "Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.", "Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur.", "Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.", "Lorem ipsum dolor sit amet, consectetur adipiscing elit.", "Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.", "Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.", "Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur.", "Lorem ipsum dolor sit amet, consectetur adipiscing elit.", "Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.", "Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.", "Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur.", "Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.", "Lorem ipsum dolor sit amet, consectetur adipiscing elit.", "Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.", "Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.", "Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur.", "Lorem ipsum dolor sit amet, consectetur adipiscing elit.", "Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.", "Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.", "Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur.", "Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.", "Lorem ipsum dolor sit amet, consectetur adipiscing elit.", "Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.", "Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.", "Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur.", "Lorem ipsum dolor sit amet, consectetur adipiscing elit.", "Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.", "Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.", "Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur.", "Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.", "Lorem ipsum dolor sit amet, consectetur adipiscing elit.", "Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.", "Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.", "Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur.", "Lorem ipsum dolor sit amet, consectetur adipiscing elit.", "Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.", "Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.", "Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur.", "Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.", "Lorem ipsum dolor sit amet, consectetur adipiscing elit.", "Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.", "Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.", "Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur.", "Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.", "Lorem ipsum dolor sit amet, consectetur adipiscing elit.", "Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.", "Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.", "Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur.", "Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.", "Lorem ipsum dolor sit amet, consectetur adipiscing elit.", "Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.", "Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.", "Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur.", "Lorem ipsum dolor sit amet, consectetur adipiscing elit.", "Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.", "Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.", "Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur.", "Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.", "Lorem ipsum dolor sit amet, consectetur adipiscing elit.", "Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.", "Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.", "Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur.", "Lorem ipsum dolor sit amet, consectetur adipiscing elit.", "Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.", "Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.", "Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur.", "Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.", "Lorem ipsum dolor sit amet, consectetur adipiscing elit.", "Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.", "Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.", "Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur.", "Lorem ipsum dolor sit amet, consectetur adipiscing elit.", "Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.", "Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.", "Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur.", "Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.", "Lorem ipsum dolor sit amet, consectetur adipiscing elit.", "Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.", "Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.", "Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur.", "Lorem ipsum dolor sit amet, consectetur adipiscing elit.", "Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.", "Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.", "Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur.", "Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.", "Lorem ipsum dolor sit amet, consectetur adipiscing elit.", "Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.", "Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.", "Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur.", "Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum."),
            "002", List.of("Mensagem 01", "Mensagem 02", "Mensagem 03", "Mensagem 04", "Mensagem 05", "Mensagem 06", "Mensagem 07", "Mensagem 08", "Mensagem 09", "Mensagem 10", "Mensagem 11", "Mensagem 12", "Mensagem 13", "Mensagem 14", "Mensagem 15", "Mensagem 16", "Mensagem 17", "Mensagem 18", "Mensagem 19", "Mensagem 20", "Mensagem 21", "Mensagem 22", "Mensagem 23", "Mensagem 24", "Mensagem 25", "Mensagem 26", "Mensagem 27", "Mensagem 28", "Mensagem 29", "Mensagem 30", "Mensagem 31", "Mensagem 32", "Mensagem 33", "Mensagem 34", "Mensagem 35", "Mensagem 36", "Mensagem 37", "Mensagem 38", "Mensagem 39", "Mensagem 40", "Mensagem 41", "Mensagem 42", "Mensagem 43", "Mensagem 44", "Mensagem 45", "Mensagem 46", "Mensagem 47", "Mensagem 48", "Mensagem 49", "Mensagem 50", "Mensagem 51", "Mensagem 52", "Mensagem 53", "Mensagem 54", "Mensagem 55", "Mensagem 56", "Mensagem 57", "Mensagem 58", "Mensagem 59", "Mensagem 60", "Mensagem 61", "Mensagem 62", "Mensagem 63", "Mensagem 64", "Mensagem 65", "Mensagem 66", "Mensagem 67", "Mensagem 68", "Mensagem 69", "Mensagem 70", "Mensagem 71", "Mensagem 72", "Mensagem 73", "Mensagem 74", "Mensagem 75", "Mensagem 76", "Mensagem 77", "Mensagem 78", "Mensagem 79", "Mensagem 80", "Mensagem 81", "Mensagem 82", "Mensagem 83", "Mensagem 84", "Mensagem 85", "Mensagem 86", "Mensagem 87", "Mensagem 88", "Mensagem 89", "Mensagem 90", "Mensagem 91", "Mensagem 92", "Mensagem 93", "Mensagem 94", "Mensagem 95", "Mensagem 96", "Mensagem 97", "Mensagem 98", "Mensagem 99", "Mensagem 100", "Mensagem 101", "Mensagem 102", "Mensagem 103", "Mensagem 104", "Mensagem 105", "Mensagem 106", "Mensagem 107", "Mensagem 108", "Mensagem 109", "Mensagem 110", "Mensagem 111", "Mensagem 112", "Mensagem 113", "Mensagem 114", "Mensagem 115", "Mensagem 116", "Mensagem 117", "Mensagem 118", "Mensagem 119", "Mensagem 120", "Mensagem 121", "Mensagem 122", "Mensagem 123", "Mensagem 124", "Mensagem 125", "Mensagem 126", "Mensagem 127", "Mensagem 128", "Mensagem 129", "Mensagem 130", "Mensagem 131", "Mensagem 132", "Mensagem 133", "Mensaje 134", "Mensagem 135", "Mensagem 136", "Mensagem 137", "Mensagem 138", "Mensagem 139", "Mensagem 140", "Mensagem 141", "Mensagem 142", "Mensagem 143", "Mensagem 144", "Mensagem 145", "Mensagem 146", "Mensagem 147", "Mensagem 148", "Mensagem 149", "Mensagem 150", "Mensagem 151", "Mensagem 152", "Mensagem 153", "Mensagem 154", "Mensagem 155", "Mensagem 156", "Mensagem 157", "Mensagem 158", "Mensagem 159", "Mensagem 160", "Mensagem 161", "Mensagem 162", "Mensagem 163", "Mensagem 164", "Mensagem 165", "Mensagem 166", "Mensagem 167", "Mensagem 168", "Mensagem 169", "Mensagem 170", "Mensagem 171", "Mensagem 172", "Mensagem 173", "Mensagem 174", "Mensagem 175", "Mensagem 176", "Mensagem 177", "Mensagem 178", "Mensagem 179", "Mensagem 180", "Mensagem 181", "Mensagem 182", "Mensagem 183", "Mensagem 184", "Mensagem 185", "Mensagem 186", "Mensagem 187", "Mensagem 188", "Mensagem 189", "Mensagem 190", "Mensagem 191", "Mensagem 192", "Mensagem 193", "Mensagem 194", "Mensagem 195", "Mensagem 196", "Mensagem 197", "Mensagem 198", "Mensagem 199", "Mensagem 200", "Mensagem 201", "Mensagem 202", "Mensagem 203", "Mensagem 204", "Mensagem 205", "Mensagem 206", "Mensagem 207", "Mensagem 208", "Mensagem 209", "Mensagem 210", "Mensagem 211", "Mensagem 212", "Mensagem 213", "Mensagem 214", "Mensagem 215")
    );


    @GET
    @Path("{id}")
    public Multi<String> get(@PathParam("id") final String id) {
        return sendPushReceipts(id);
    }



    private Multi<String> sendPushReceipts(final String id) {
        final int chunkSize = 2;
        return Multi.createFrom()
                    .iterable(map.get(id))
                    .group().intoLists().of(chunkSize)
                    .onItem().transformToUni(list -> {
                        log.info("Sending: " + list);
                        try {
                            Thread.sleep(200);
                        } catch (InterruptedException e) {
                            e.printStackTrace();
                        }
                        String msg = list.size() == chunkSize ? String.join(", ", list) + ", " : list.get(0) ;
                        return Uni.createFrom().item(msg);
                    }).merge();
    }

}
